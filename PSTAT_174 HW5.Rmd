---
title: "PSTAT174_HW5"
author: "Yujie Ye"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 1.

- define working directory
```{r, eval=FALSE}
setwd()
```

- read and plot data
```{r, eval=FALSE}
#read data
raw_data <- read.table("data.csv", sep = ",", header = FALSE)
data_ts = ts(raw_data)
#plot
plot.ts(data_ts)
```

- simulate and plot ARMA models
```{r, eval=FALSE}
x <- arima.sim(model = list(ma = c(), ar = c(), sd = 1), n="number")
plot.ts(x)
```

- add trend and mean line to the original time series plot
```{r, eval=FALSE}
fit <- lm(data ~ time)
abline(fit)
abline(h = mean(data))
```

- calculate and plot theoretical acf/pacf for ARMA
```{r, eval=FALSE}
#acf
pacf_sim = ARMAacf(ar = c(), ma = c(), pacf = FALSE,lag.max = 10)
plot(x = 1:10, y = acf_sim,type = "h")
abline(h = 0)

#pacf
acf_sim = ARMAacf(ar = c(), ma = c(), pacf = TRUE,lag.max = 10)
plot(x = 0:10,y = pacf_sim,type = "h")
abline(h = 0)
```

- calculate and plot sample acf/pacf
```{r, eval=FALSE}
x = (data_ts)
acf(x)
acf(x)$acf
pacf(x)
pacf(x)$acf
```

- check whether a particular model is causal/invertible
```{r, eval=FALSE}
source("plot.roots.R")
plot.roots(NULL,polyroot(c()), main  = "")
```

– perform Box-Cox transforms
```{r, eval=FALSE}
library(MASS)
t = 1:length(data)
fit = lm(data ~ t)
bcTransform = boxcox(data ~ t,plotit = TRUE)
lambda = bcTransform$x[which(bcTransform$y == max(bcTransform$y))]
data.bc = (1/lambda)*(data^lambda-1)
```

– perform differencing data at lags 1 and 12
```{r, eval=FALSE}
diff(x, lag = 1)
diff(x, lag = 12)
```

– perform Yule-Walker estimation and find standard deviations of the estimates
```{r, eval=FALSE}
ar(data, method = "yule-walker")
ar(data, method = "yule-walker")$asy.var.coef
```

– perform MLE and check AICC associated with the model
```{r, eval=FALSE}
arima(data, order = c(), method = "ML")
library(qpcR)
AICc(data)
```

## 2.
```{r} 
setwd("/Users/johnnys/Downloads/PSTAT 174")
frozen = read.table("Frozen Dessert production.csv",
                      sep=",", header=FALSE, skip=1)
```

# a)
Data set description: The data set shows the industrial production (IP) index measures the real output of all ice cream and frozen dessert establishments located in the United States, regardless of their ownership, from 1972.01 to 2022.08.

# b)
Motivation and objectives: This data set is interesting because we can find the relation between the time and the production of ice cream and frozen dessert, which can help us to decide how much we should produce in the future months.
I want to forecast the industrial production of ice cream and frozen dessert in the coming year.

# c)
```{r}
ice1 = ts(frozen[,2], start = c(1972,1), end = c(2022,8), frequency = 12)
ts.plot(ice1, ylab = "index 2017 = 100")

op = par(mfrow = c(1,2))
acf(ice1,lag.max = 60,main = "")
pacf(ice1,lag.max = 60,main = "")
par(op)
```
(i) In the time series plot, we can find the an upward trend from 1983 to 1996 and from 2000 to 2003. There is a downward trend from 1996 to 1999 and from 2005 to 2014. 

(ii) In the plot, we can also find a strong seasonal component every year from 1972 to 2022. The cyclical behavior in the ACF and there are significant correlations with values moving proportionally every 12 lags. Therefore, we can see that the period of 
the seasonal component is given by s = 12.

(iii) The production of ice cream and frozen dessert in winter was much lower than that in summer every year. From 1983 to 1996, the production increased steadily, but from 2005 to 2014, the production decreased sharply.


# d)
```{r}
library(MASS)
t = 1:length(ice1)
fit = lm(ice1 ~ t)
bcTransform = boxcox(ice1 ~ t,plotit = TRUE)

lambda = bcTransform$x[which(bcTransform$y == max(bcTransform$y))]

ice1.bc = (1/lambda)*(ice1^lambda-1)
ice1.log = log(ice1)
ice1.sqrt = sqrt(ice1)

op= par(mfrow=c(1,2))
ts.plot(ice1, main = "Original Times Series")
ts.plot(ice1.bc, main = "Box-Cox Transform")
ts.plot(ice1.log, main = "Log Transform")
ts.plot(ice1.sqrt, main = "Square Root Transform")
```

```{r}
y2 = diff(ice1, 12)
y21 = diff(y2, 1)
ts.plot(y2, main = "De-seasonalized Time Series",
        ylab = expression(nabla^{12}~nabla~Y[t])) 
abline(h = 0,lty = 2)

ts.plot(y21,main= "De-trended/seasonalized Time Series",ylab = expression(nabla^{12}~nabla~Y[t]))
abline(h = 0,lty = 2)
```

I used Box-Cox transform because my original time series plot shows inconstant variance, and Box-Cox transform can stabilize the variance.

I also used differencing at lag 1 and 12 because differencing at lag 1 can remove trend component and lag 12 (determined by ACF) can remove seasonal component.

Yes, it is stationary now.



# e)
```{r}
op = par(mfrow = c(1,2))
acf(y21,lag.max = 60,main = "")
pacf(y21,lag.max = 60,main = "")
title("De-trended/seasonalized Time Series",line = -1, outer=TRUE)
```
We applied one seasonal differencing and one differencing to remove the trend, so D = 1 at lag s = 12 and d = 1.

The ACF shows a strong peak at h = 1s, so Q could be 1.

The PACF shows a strong peak at h = 1s and some smaller peaks apprearing at h = 2s, 3s and 4s, so P could be 1 or 4.

The ACF seems to be tailing off within 1s or perhaps cuts off at lag1. So a good choice for MA part could be q = 0 or q = 4.

The PACF cuts off at lag h = 1 within 1s, so it would be a good choice if p = 1.

So my model would be:
SARNA$(p,d,q)$ $\times$ $(P,D,Q)_s$ = SARNA$(1,1,0)$ $\times$ $(1,1,1)_{12}$








